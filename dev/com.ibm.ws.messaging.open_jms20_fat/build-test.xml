<?xml version="1.0" encoding="UTF-8"?>
<project name="com.ibm.ws.messaging.jms20_fat" default="buildandrun" basedir=".">

  <property name="javac.boot.classpath" value="1.7"/>

  <import file="../ant_build/public_imports/fat_imports.xml"/>

  <property name="shared.resource.dir" value="${liberty.dir}/usr/shared/resources"/>
  <property name="features.dir" value="${basedir}/publish/files/features"/>

  <!-- Copy our bundle of utility classes in to autoFVT.zip -->

  <!-- In open-liberty, thecopy will find these jars:
         com.ibm.ws.event.logging_1.0.40.jar
         com.ibm.ws.logging_1.0.40.jar
         com.ibm.ws.org.jboss.logging_1.0.40.jar
    -->

  <target name="addRequiredLibraries">
    <mkdir dir="${features.dir}"/>
    <copy todir="${required.lib.dir}">
      <fileset dir="../build.image/wlp/lib" includes="com.ibm.ws.logging_*.jar"/>
    </copy>
  </target>

  <target
    name="addAutoInstallApplications"
    description="Automatically install applications on LibertyServer instance creation">

    <echo message="create apps"/>

    <property name="files.dir" value="${basedir}/publish/files"/>
    <property name="server.dir" value="${basedir}/publish/servers/TestServer"/>

    <mkdir dir="${server.dir}/apps"/>

    <move
      file="${basedir}/publish/files/jmsmdb.zip"
      tofile="${server.dir}/apps/jmsmdb.jar"/>

    <zip destfile="${server.dir}/apps/jmsapp.ear" >
      <zipfileset dir="${server.dir}/apps" includes="*.jar"/>
    </zip>

    <mkdir dir="${server.dir}/dropins"/>

    <copy todir="${server.dir}/dropins">
      <fileset dir="../com.ibm.ws.security.registry_test.servlet/build/test-application" includes="*.war"/>
    </copy>

    <move file="${files.dir}/JMSProducer.zip" tofile="${server.dir}/dropins/JMSProducer.war"/>
    <move file="${files.dir}/SharedSubscription.zip" tofile="${server.dir}/dropins/SharedSubscription.war"/>
    <move file="${files.dir}/JMSConsumer_118076.zip" tofile="${server.dir}/dropins/JMSConsumer_118076.war"/>
    <move file="${files.dir}/JMSConsumer_118077.zip" tofile="${server.dir}/dropins/JMSConsumer_118077.war"/>
    <move file="${files.dir}/JMSRedelivery_120846.zip" tofile="${server.dir}/dropins/JMSRedelivery_120846.war"/>
    <move file="${files.dir}/JMSProducer_118073.zip" tofile="${server.dir}/dropins/JMSProducer_118073.war"/>
    <move file="${files.dir}/SharedSubscriptionWithMsgSel.zip" tofile="${server.dir}/dropins/SharedSubscriptionWithMsgSel.war"/>
    <move file="${files.dir}/DurableUnshared.zip" tofile="${server.dir}/dropins/DurableUnshared.war"/>
    <move file="${files.dir}/JMSContextInject.zip" tofile="${server.dir}/dropins/JMSContextInject.war"/>
    <move file="${files.dir}/JMSDefaultConnectionFactoryTest.zip" tofile="${server.dir}/dropins/JMSDefaultConnectionFactoryTest.war"/>
    <move file="${files.dir}/JMSDefaultCFVariation.zip" tofile="${server.dir}/dropins/JMSDefaultCFVariation.war"/>
    <move file="${files.dir}/JMSMbeans.zip" tofile="${server.dir}/dropins/JMSMbeans.war"/>
    <move file="${files.dir}/mdbapp.zip" tofile="${server.dir}/dropins/mdbapp.war"/>
    <move file="${files.dir}/mdbapp1.zip" tofile="${server.dir}/dropins/mdbapp1.war"/>

    <delete>
      <fileset dir="${server.dir}/apps">
        <include name="jmsmdb.jar"/>
      </fileset>
    </delete>

  </target>

</project>
